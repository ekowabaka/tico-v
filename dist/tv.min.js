!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.tv=t():e.tv=t()}(self,(()=>(()=>{"use strict";var e={d:(t,r)=>{for(var a in r)e.o(r,a)&&!e.o(t,a)&&Object.defineProperty(t,a,{enumerable:!0,get:r[a]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r:e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}},t={};e.r(t),e.d(t,{bind:()=>u});class r{#e;constructor(){this.#e={variable:new RegExp("{{\\s*([a-z][a-z0-9_]*)\\s*}}","i"),condstr:new RegExp('{{\\s*([a-z][a-z0-9_]*)\\s*\\?\\s*"([^"]*)"\\s*}}',"i"),condstrelse:new RegExp('{{\\s*([a-z][a-z0-9_]*)\\s*\\?\\s*"([^"]*)"\\s*:\\s*"([^"]*)"\\s*}}',"i"),cond:new RegExp('{{\\s*([a-z][a-z0-9_]*)\\s*\\?\\s*([^"]*)\\s*}}',"i"),text:new RegExp("{{","i")}}#t(e,t,r){t.index>0&&r.push({type:"txt",value:e.substring(0,t.index)})}parse(e){let t,r=[],a=new Set,s=["variable","condstrelse","condstr","cond","text"],n=0;for(;e.length>0;){let i=null;if(void 0!==t&&t===n)throw`Error parsing ${e}`;t=n;for(let t in s){if(0===e.length)break;if(i=this.#e[s[t]].exec(e),i)switch(n=i.index+i[0].length,s[t]){case"variable":this.#t(e,i,r),r.push({type:"var",name:i[1]}),a.add(i[1]),e=e.substr(n,e.length-n);break;case"condstr":case"cond":this.#t(e,i,r),r.push({type:s[t],var1:i[1].trim(),var2:i[2].trim()}),a.add(i[1].trim()),e=e.substr(n,e.length-n),"cond"===s[t]&&a.add(i[2].trim());break;case"condstrelse":this.#t(e,i,r),r.push({type:"condstrelse",var1:i[1],var2:i[2],var3:i[3]}),a.add(i[1]),e=e.substr(n,e.length-n);break;case"text":this.#t(e,i,r),e=e.substr(i.index,e.length-i.index)}if(i)break}if(null===i&&e.length>0){r.push({type:"txt",value:e});break}}return{variables:a,structure:r}}}class a{#r;#a;constructor(){this.#r=new r,this.#a=["tv-foreach","tv-true","tv-not-true","(tv-value)-([a-z0-9_-]+)","(tv-).*"].map((e=>new RegExp(e,"i")))}#s(e,t,r){e.has(t)||e.set(t,[]),e.get(t).push(r)}#n(e,t){t.forEach(((t,r)=>{e.has(r)?e.get(r).concat(t):e.set(r,t)}))}#i(e,t){const r={parentVariable:null,variables:new Map};for(const a of e.attributes)for(const s of this.#a){const n=s.exec(a.name);if(n){if("tv-value"===n[1]){const s=document.createAttribute(n[2]),i=this.#r.parse(a.value);e.setAttributeNode(s),i.variables.forEach((e=>{this.#s(r.variables,e,{node:s,type:"attribute",name:n[2],structure:i.structure,path:t})}))}else"tv-true"===n[0]?this.#s(r.variables,a.value,{node:e,type:"truth",name:a.value,display:e.style.display,path:t}):"tv-not-true"===n[0]?this.#s(r.variables,a.value,{node:e,type:"not-truth",name:a.value,display:e.style.display,path:t}):"tv-foreach"===n[0]&&(r.parentVariable={template:e.childNodes,childElementCount:e.childElementCount,type:"foreach",parent:e,name:a.value,variables:new Map,path:t,id:null});break}}return r}#o(e,t){const r=new Map,a=this.#i(e,t);let s;a.parentVariable?(s=Array.from(e.childNodes).map((e=>e.cloneNode(!0))),a.parentVariable.template=s):s=e.childNodes,this.#n(r,a.variables);let n=1;return s.forEach(((e,s)=>{let i=[];if(e.nodeType===Node.TEXT_NODE)i=this.#r.parse(e.textContent),i.variables.forEach((a=>{this.#s(r,a,{node:e,type:"text",structure:i.structure,path:t,index:s})}));else if(e.nodeType===Node.ELEMENT_NODE){const s=this.#o(e,a?"":`${t}${""===t?"":">"}${e.nodeName}:nth-child(${n})`);a.parentVariable?(this.#n(a.parentVariable.variables,s),this.#s(r,a.parentVariable.name,a.parentVariable)):this.#n(r,s),n++}})),r}parse(e){return this.#o(e,"")}}function s(e,t){return e.reduce(((e,r)=>{switch(r.type){case"var":return e+t[r.name];case"txt":return e+r.value;case"cond":return e+(t[r.var1]?t[r.var1]:t[r.var2]);case"condstr":return e+(t[r.var1]?r.var2:"");case"condstrelse":return e+(t[r.var1]?r.var2:r.var3)}}),"")}class n{#l;constructor(e){this.#l=e}update(e,t){(t||this.#l.node).textContent=s(this.#l.structure,e)}}class i{#l;constructor(e){this.#l=e}update(e,t){(t||this.#l.node).value=s(this.#l.structure,e)}}class o{#l;#h;constructor(e,t){this.#l=e,this.#h=t}update(e,t){let r=t||this.#l.node;e[this.#l.name]&&!this.#h||!e[this.#l.name]&&this.#h?r.style.display=this.#l.display:r.style.display="none"}}class l{#l;#d;constructor(e,t){this.#l=e,this.#d=h.create(e.variables,t),this.#l.manipulators=this.#d}#p(e,t){const r=new Event("tv-update");r.detail={nodes:e.filter((e=>e.nodeType!=Node.TEXT_NODE||""!=e.nodeValue.trim())),data:t},this.#l.parent.dispatchEvent(r)}update(e){if(e=e[this.#l.name],this.#l.parent.innerHTML="",Array.isArray(e))for(let t of e){const e=[];this.#d.forEach((e=>e.update(t))),this.#l.template.forEach((t=>{const r=t.cloneNode(!0);e.push(r),this.#l.parent.appendChild(r)})),this.#p(e,t)}}set(e,t){const r=[];this.#d.forEach((e=>e.update(t))),this.#l.template.forEach(((t,a)=>{const s=t.cloneNode(!0);r.push(s),e*this.#l.template.length+a===this.#l.parent.childNodes.length?this.#l.parent.appendChild(s):this.#l.parent.replaceChild(s,this.#l.parent.childNodes[e*this.#l.template.length+a])})),this.#p(r,t)}}const h={create:function(e,t){let r,a=[];return e.forEach((e=>{e.forEach((e=>{switch(e.type){case"text":r=new n(e);break;case"attribute":r=new i(e);break;case"truth":r=new o(e,!1);break;case"not-truth":r=new o(e,!0);break;case"foreach":r=new l(e,t);break;default:throw`Unknown type ${e.type}`}r.variables=e,a.push(r)}))})),a}};class d{#c;#d;#u;#y;constructor(e,t){this.#c=e,this.#d=t,this.#u=new WeakMap,this.#y=new WeakMap}get(e,t){if("function"==typeof e[t]||"object"!=typeof e[t])return e[t];let r;for(const a of this.#c)if(r=a.parent.children[t],!this.#u.has(r)){const s=new Proxy(e[t],new p(a.variables,a.manipulators,a.parent.children[t]));this.#u.set(r,s),this.#y.set(s,e[t]);break}return this.#u.get(r)}set(e,t,r){return this.#y.has(r)&&(r=this.#y.get(r)),e[t]=r,"length"===t?(this.#c.forEach((e=>{for(let t=0;t<e.parent.children.length-r;t++)e.parent.removeChild(e.parent.lastChild)})),!0):(this.#d.forEach((r=>null!=r.set&&r.set(t,e[t]))),!0)}}class p{#b;#d;#v;constructor(e,t,r){this.#b=e,this.#d=t,this.#v=r}get(e,t){if("object"==typeof e[t]&&Array.isArray(e[t])&&"foreach"===this.#b.get(t)[0].type){const r=new d(this.#b.get(t),this.#d);return new Proxy(e[t],r)}return e[t],e[t]}set(e,t,r){return e[t]=r,this.run(e),!0}run(e){this.#d.forEach((t=>{let r;if(this.#v){const e=""===t.variables.path?this.#v:this.#v.querySelector(t.variables.path);r="text"==t.variables.type?e.childNodes[t.variables.index]:"attribute"==t.variables.type?e.getAttributeNode(t.variables.name):e}t.update(e,r)}))}}class c{#f;#b;#d;constructor(e,t){this.#f=new Proxy({},new p(e,t)),this.#b=e,this.#d=t}set data(e){let t=new p(this.#b,this.#d);this.#f=new Proxy(e,t),t.run(e)}get data(){return this.#f}}function u(e){const t="string"==typeof e?document.querySelector(e):e;if(t){const e=(new a).parse(t),r=h.create(e);return new c(e,r)}throw new Error("Could not find template node")}return t})()));