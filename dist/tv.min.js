!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.tv=t():e.tv=t()}(self,(()=>(()=>{"use strict";var e={d:(t,r)=>{for(var a in r)e.o(r,a)&&!e.o(t,a)&&Object.defineProperty(t,a,{enumerable:!0,get:r[a]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r:e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}},t={};e.r(t),e.d(t,{bind:()=>u});class r{#e;#t;constructor(){this.#e={variable:new RegExp("{{\\s*([a-z][a-z0-9_]*)\\s*}}","i"),condstr:new RegExp('{{\\s*([a-z][a-z0-9_]*)\\s*\\?\\s*"([^"]*)"\\s*}}',"i"),condstrelse:new RegExp('{{\\s*([a-z][a-z0-9_]*)\\s*\\?\\s*"([^"]*)"\\s*:\\s*"([^"]*)"\\s*}}',"i"),cond:new RegExp('{{\\s*([a-z][a-z0-9_]*)\\s*\\?\\s*([^"]*)\\s*}}',"i"),text:new RegExp("{{","i")}}#r(e,t,r){t.index>0&&r.push({type:"txt",value:e.substring(0,t.index)})}parse(e){let t,r=[],a=new Set,s=["variable","condstrelse","condstr","cond","text"],n=0;for(;e.length>0;){let i=null;if(void 0!==t&&t===n)throw`Error parsing ${e}`;t=n;for(let t in s){if(0===e.length)break;if(i=this.#e[s[t]].exec(e),i)switch(n=i.index+i[0].length,s[t]){case"variable":this.#r(e,i,r),r.push({type:"var",name:i[1]}),a.add(i[1]),e=e.substr(n,e.length-n);break;case"condstr":case"cond":this.#r(e,i,r),r.push({type:s[t],var1:i[1].trim(),var2:i[2].trim()}),a.add(i[1].trim()),e=e.substr(n,e.length-n),"cond"===s[t]&&a.add(i[2].trim());break;case"condstrelse":this.#r(e,i,r),r.push({type:"condstrelse",var1:i[1],var2:i[2],var3:i[3]}),a.add(i[1]),e=e.substr(n,e.length-n);break;case"text":this.#r(e,i,r),e=e.substr(i.index,e.length-i.index)}if(i)break}if(null===i&&e.length>0){r.push({type:"txt",value:e});break}}return{variables:a,structure:r}}}class a{#a;#s;constructor(){this.#a=new r,this.#s=["tv-foreach","tv-true","tv-not-true","(tv-value)-([a-z0-9_-]+)","(tv-).*"].map((e=>new RegExp(e,"i")))}#n(e,t,r){e.has(t)||e.set(t,[]),e.get(t).push(r)}#i(e,t){t.forEach(((t,r)=>{e.has(r)?e.get(r).concat(t):e.set(r,t)}))}#o(e,t,r){let a=!1;const s=new Map;for(const n of e.attributes)for(const i of this.#s){const o=i.exec(n.name);if(o){if("tv-value"===o[1]){const t=document.createAttribute(o[2]),a=this.#a.parse(n.value);e.setAttributeNode(t),a.variables.forEach((e=>{this.#n(s,e,{node:t,type:"attribute",name:o[2],structure:a.structure,path:r})}))}else"tv-true"===o[0]?this.#n(s,n.value,{node:e,type:"truth",name:n.value,display:e.style.display,path:r}):"tv-not-true"===o[0]?this.#n(s,n.value,{node:e,type:"not-truth",name:n.value,display:e.style.display,path:r}):"tv-foreach"===o[0]&&(a={template:e.childNodes,childElementCount:e.childElementCount,type:"foreach",parent:e,name:n.value,variables:s,path:r,id:null},this.#n(t,n.value,a));break}}return a||this.#i(t,s),s.forEach((e=>e.path)),a}#h(e,t,r){const a=this.#o(e,t,r);let s;a?(t=a.variables,s=Array.from(e.childNodes).map((e=>e.cloneNode(!0)))):s=e.childNodes;let n=1;s.forEach(((e,s)=>{let i=[];e.nodeType===Node.TEXT_NODE?(i=this.#a.parse(e.textContent),i.variables.forEach((a=>{this.#n(t,a,{node:e,type:"text",structure:i.structure,path:r,index:s})}))):e.nodeType===Node.ELEMENT_NODE&&(this.#h(e,t,a?"":`${r}${""===r?"":">"}${e.nodeName}:nth-child(${n})`),n++)})),a&&(a.template=s)}parse(e){const t=new Map;return this.#h(e,t,""),t}}function s(e,t){return e.reduce(((e,r)=>{switch(r.type){case"var":return e+t[r.name];case"txt":return e+r.value;case"cond":return e+(t[r.var1]?t[r.var1]:t[r.var2]);case"condstr":return e+(t[r.var1]?r.var2:"");case"condstrelse":return e+(t[r.var1]?r.var2:r.var3)}}),"")}class n{#l;constructor(e){this.#l=e}update(e,t){(t||this.#l.node).textContent=s(this.#l.structure,e)}}class i{#l;constructor(e){this.#l=e}update(e,t){(t||this.#l.node).value=s(this.#l.structure,e)}}class o{#l;#d;constructor(e,t){this.#l=e,this.#d=t}update(e,t){let r=t||this.#l.node;e[this.#l.name]&&!this.#d||!e[this.#l.name]&&this.#d?r.style.display=this.#l.display:r.style.display="none"}}class h{#l;#c;constructor(e,t){this.#l=e,this.#c=l.create(e.variables,t),this.#l.manipulators=this.#c}#p(e,t){const r=new Event("tv-update");r.detail={nodes:e.filter((e=>e.nodeType!=Node.TEXT_NODE||""!=e.nodeValue.trim())),data:t},this.#l.parent.dispatchEvent(r)}update(e){if(e=e[this.#l.name],this.#l.parent.innerHTML="",Array.isArray(e))for(let t of e){const e=[];this.#c.forEach((e=>e.update(t))),this.#l.template.forEach((t=>{const r=t.cloneNode(!0);e.push(r),this.#l.parent.appendChild(r)})),this.#p(e,t)}}set(e,t){const r=[];this.#c.forEach((e=>e.update(t))),this.#l.template.forEach(((t,a)=>{const s=t.cloneNode(!0);r.push(s),e*this.#l.template.length+a===this.#l.parent.childNodes.length?this.#l.parent.appendChild(s):this.#l.parent.replaceChild(s,this.#l.parent.childNodes[e*this.#l.template.length+a])})),this.#p(r,t)}}const l={create:function(e,t){let r,a=[];return e.forEach((e=>{e.forEach((e=>{switch(e.type){case"text":r=new n(e);break;case"attribute":r=new i(e);break;case"truth":r=new o(e,!1);break;case"not-truth":r=new o(e,!0);break;case"foreach":r=new h(e,t);break;default:throw`Unknown type ${e.type}`}r.variables=e,a.push(r)}))})),a}};class d{#u;#c;#y;#v;constructor(e,t){this.#u=e,this.#c=t,this.#y=new WeakMap,this.#v=new WeakMap}get(e,t){if("function"==typeof e[t]||"object"!=typeof e[t])return e[t];let r;for(const a of this.#u)if(r=a.parent.children[t],!this.#y.has(r)){const s=new Proxy(e[t],new c(a.variables,a.manipulators,a.parent.children[t]));this.#y.set(r,s),this.#v.set(s,e[t]);break}return this.#y.get(r)}set(e,t,r){return this.#v.has(r)&&(r=this.#v.get(r)),e[t]=r,"length"===t?(this.#u.forEach((e=>{for(let t=0;t<e.parent.children.length-r;t++)e.parent.removeChild(e.parent.lastChild)})),!0):(this.#c.forEach((r=>null!=r.set&&r.set(t,e[t]))),!0)}}class c{#b;#c;#f;constructor(e,t,r){this.#b=e,this.#c=t,this.#f=r}get(e,t){if("object"==typeof e[t]&&Array.isArray(e[t])&&"foreach"===this.#b.get(t)[0].type){const r=new d(this.#b.get(t),this.#c);return new Proxy(e[t],r)}return e[t],e[t]}set(e,t,r){return e[t]=r,this.run(e),!0}run(e){this.#c.forEach((t=>{let r;if(this.#f){const e=""===t.variables.path?this.#f:this.#f.querySelector(t.variables.path);r="text"==t.variables.type?e.childNodes[t.variables.index]:"attribute"==t.variables.type?e.getAttributeNode(t.variables.name):e}t.update(e,r)}))}}class p{#x;#b;#c;constructor(e,t){this.#x=new Proxy({},new c(e,t)),this.#b=e,this.#c=t}set data(e){let t=new c(this.#b,this.#c);this.#x=new Proxy(e,t),t.run(e)}get data(){return this.#x}}function u(e){const t="string"==typeof e?document.querySelector(e):e;if(t){const e=(new a).parse(t),r=l.create(e);return new p(e,r)}throw new Error("Could not find template node")}return t})()));