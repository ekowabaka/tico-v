!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.tv=t():e.tv=t()}(self,(()=>(()=>{"use strict";var e={d:(t,r)=>{for(var a in r)e.o(r,a)&&!e.o(t,a)&&Object.defineProperty(t,a,{enumerable:!0,get:r[a]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r:e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}},t={};e.r(t),e.d(t,{bind:()=>b});class r{#e;constructor(){this.#e={variable:new RegExp("{{\\s*([a-z][a-z0-9_]*)\\s*}}","i"),condstr:new RegExp('{{\\s*([a-z][a-z0-9_]*)\\s*\\?\\s*"([^"]*)"\\s*}}',"i"),condstrelse:new RegExp('{{\\s*([a-z][a-z0-9_]*)\\s*\\?\\s*"([^"]*)"\\s*:\\s*"([^"]*)"\\s*}}',"i"),cond:new RegExp('{{\\s*([a-z][a-z0-9_]*)\\s*\\?\\s*([^"]*)\\s*}}',"i"),text:new RegExp("{{","i")}}#t(e,t,r){t.index>0&&r.push({type:"txt",value:e.substring(0,t.index)})}parse(e){let t,r=[],a=new Set,s=["variable","condstrelse","condstr","cond","text"],n=0;for(;e.length>0;){let i=null;if(void 0!==t&&t===n)throw`Error parsing ${e}`;t=n;for(let t in s){if(0===e.length)break;if(i=this.#e[s[t]].exec(e),i)switch(n=i.index+i[0].length,s[t]){case"variable":this.#t(e,i,r),r.push({type:"var",name:i[1]}),a.add(i[1]),e=e.substr(n,e.length-n);break;case"condstr":case"cond":this.#t(e,i,r),r.push({type:s[t],var1:i[1].trim(),var2:i[2].trim()}),a.add(i[1].trim()),e=e.substr(n,e.length-n),"cond"===s[t]&&a.add(i[2].trim());break;case"condstrelse":this.#t(e,i,r),r.push({type:"condstrelse",var1:i[1],var2:i[2],var3:i[3]}),a.add(i[1]),e=e.substr(n,e.length-n);break;case"text":this.#t(e,i,r),e=e.substr(i.index,e.length-i.index)}if(i)break}if(null===i&&e.length>0){r.push({type:"txt",value:e});break}}return{variables:a,structure:r}}}class a{#r;#a;constructor(){this.#r=new r,this.#a=["tv-foreach","tv-true","tv-not-true","(tv-value)-([a-z0-9_-]+)","(tv-set)-([a-z0-9_-]+)","(tv-).*"].map((e=>new RegExp(e,"i")))}#s(e,t,r){e.has(t)||e.set(t,[]),e.get(t).push(r)}#n(e,t){t.forEach(((t,r)=>{e.has(r)?e.set(r,e.get(r).concat(t)):e.set(r,t)}))}#i(e,t){const r={parentVariable:null,variables:new Map};for(const a of e.attributes)for(const s of this.#a){const n=s.exec(a.name);if(n){if("tv-value"===n[1]){const s=document.createAttribute(n[2]),i=this.#r.parse(a.value);e.setAttributeNode(s),i.variables.forEach((e=>{this.#s(r.variables,e,{node:s,type:"attribute",name:n[2],structure:i.structure,path:t})}))}else"tv-set"===n[1]?this.#s(r.variables,a.value,{node:e,type:"set",name:a.value,path:t,attribute:n[2]}):"tv-true"===n[0]?this.#s(r.variables,a.value,{node:e,type:"truth",name:a.value,display:e.style.display,path:t}):"tv-not-true"===n[0]?this.#s(r.variables,a.value,{node:e,type:"not-truth",name:a.value,display:e.style.display,path:t}):"tv-foreach"===n[0]&&(r.parentVariable={template:e.childNodes,childElementCount:e.childElementCount,type:"foreach",parent:e,name:a.value,variables:new Map,path:t,id:null});break}}return r}#o(e,t){const r=new Map,a=this.#i(e,t);let s;a.parentVariable?(s=Array.from(e.childNodes).map((e=>e.cloneNode(!0))),a.parentVariable.template=s):s=e.childNodes,this.#n(r,a.variables);let n=1;return s.forEach(((e,s)=>{let i=[];if(e.nodeType===Node.TEXT_NODE)i=this.#r.parse(e.textContent),i.variables.forEach((a=>{this.#s(r,a,{node:e,type:"text",structure:i.structure,path:t,index:s})}));else if(e.nodeType===Node.ELEMENT_NODE){const s=this.#o(e,a?"":`${t}${""===t?"":">"}${e.nodeName}:nth-child(${n})`);a.parentVariable?(this.#n(a.parentVariable.variables,s),this.#s(r,a.parentVariable.name,a.parentVariable)):this.#n(r,s),n++}})),r}parse(e){return this.#o(e,"")}}function s(e,t){return e.reduce(((e,r)=>{switch(r.type){case"var":return e+t[r.name];case"txt":return e+r.value;case"cond":return e+(t[r.var1]?t[r.var1]:t[r.var2]);case"condstr":return e+(t[r.var1]?r.var2:"");case"condstrelse":return e+(t[r.var1]?r.var2:r.var3)}}),"")}class n{#h;constructor(e){this.#h=e}update(e,t){(t||this.#h.node).textContent=s(this.#h.structure,e)}}class i{#h;constructor(e){this.#h=e}update(e,t){(t||this.#h.node).value=s(this.#h.structure,e)}}class o{#h;constructor(e){this.#h=e}update(e,t){const r=t||this.#h.node;e[this.#h.name]?r.setAttribute(this.#h.attribute,this.#h.attribute):r.hasAttribute(this.#h.attribute)&&r.removeAttribute(this.#h.attribute)}}class h{#h;#l;constructor(e,t){this.#h=e,this.#l=t}update(e,t){const r=t||this.#h.node;e[this.#h.name]&&!this.#l||!e[this.#h.name]&&this.#l?r.hasAttribute("hidden")&&r.removeAttribute("hidden"):r.setAttribute("hidden","hidden")}}class l{#h;#d;constructor(e,t){this.#h=e,this.#d=d.create(e.variables,t),this.#h.manipulators=this.#d}#c(e,t){const r=new Event("tv-update");r.detail={nodes:e.filter((e=>e.nodeType!==Node.TEXT_NODE||""!==e.nodeValue.trim())),data:t},this.#h.parent.dispatchEvent(r)}update(e){if(e=e[this.#h.name],this.#h.parent.innerHTML="",Array.isArray(e))for(let t of e){const e=[];this.#d.forEach((e=>e.forEach((e=>e.update(t))))),this.#h.template.forEach((t=>{const r=t.cloneNode(!0);e.push(r),this.#h.parent.appendChild(r)})),this.#c(e,t)}}set(e,t){const r=[];this.#d.forEach((e=>e.forEach((e=>e.update(t))))),this.#h.template.forEach(((t,a)=>{const s=t.cloneNode(!0);r.push(s),e*this.#h.template.length+a===this.#h.parent.childNodes.length?this.#h.parent.appendChild(s):this.#h.parent.replaceChild(s,this.#h.parent.childNodes[e*this.#h.template.length+a])})),this.#c(r,t)}}class d{static create(e,t){const r=new Map;let a;return e.forEach(((e,s)=>{const d=[];e.forEach((e=>{switch(e.type){case"text":a=new n(e);break;case"attribute":a=new i(e);break;case"truth":a=new h(e,!1);break;case"not-truth":a=new h(e,!0);break;case"foreach":a=new l(e,t);break;case"set":a=new o(e);break;default:throw`Unknown type ${e.type}`}a.variables=e,d.push(a)})),r.set(s,d)})),r}}class c{#u;#d;#p;#b;constructor(e,t){this.#u=e,this.#d=t,this.#p=new WeakMap,this.#b=new WeakMap}get(e,t){if("function"==typeof e[t]||"object"!=typeof e[t])return e[t];let r;for(const a of this.#u)if(r=a.parent.children[t],!this.#p.has(r)){const s=new Proxy(e[t],new u(a.variables,a.manipulators,a.parent.children[t]));this.#p.set(r,s),this.#b.set(s,e[t]);break}return this.#p.get(r)}set(e,t,r){return this.#b.has(r)&&(r=this.#b.get(r)),e[t]=r,"length"===t?(this.#u.forEach((e=>{for(let t=0;t<e.parent.children.length-r;t++)e.parent.removeChild(e.parent.lastChild)})),!0):(this.#d.forEach((r=>void 0!==r.set&&r.set(t,e[t]))),!0)}}class u{#y;#d;#v;constructor(e,t,r){this.#y=e,this.#d=t,this.#v=r}get(e,t){if("object"==typeof e[t]&&Array.isArray(e[t])&&"foreach"===this.#y.get(t)[0].type){const r=new c(this.#y.get(t),this.#d.get(t));return new Proxy(e[t],r)}return e[t],e[t]}set(e,t,r){return e[t]=r,this.run(e,t),!0}run(e,t){this.#d.get(t).forEach((t=>{let r;if(this.#v){const e=""===t.variables.path?this.#v:this.#v.querySelector(t.variables.path);r="text"==t.variables.type?e.childNodes[t.variables.index]:"attribute"==t.variables.type?e.getAttributeNode(t.variables.name):e}t.update(e,r)}))}}class p{#f;#y;#d;constructor(e,t){this.#y=e,this.#d=t}set data(e){let t=new u(this.#y,this.#d);this.#f=new Proxy(e,t),this.#y.keys().forEach((r=>t.run(e,r)))}get data(){return this.#f}}function b(e){const t="string"==typeof e?document.querySelector(e):e;if(t){const e=(new a).parse(t),r=d.create(e);return new p(e,r)}throw new Error("Could not find template node")}return t})()));