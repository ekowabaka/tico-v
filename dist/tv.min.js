!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.tv=t():e.tv=t()}(self,(()=>(()=>{"use strict";var e={d:(t,r)=>{for(var a in r)e.o(r,a)&&!e.o(t,a)&&Object.defineProperty(t,a,{enumerable:!0,get:r[a]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r:e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}},t={};e.r(t),e.d(t,{bind:()=>u});class r{#e;constructor(){this.#e={variable:new RegExp("{{\\s*([a-z][a-z0-9_]*)\\s*}}","i"),condstr:new RegExp('{{\\s*([a-z][a-z0-9_]*)\\s*\\?\\s*"([^"]*)"\\s*}}',"i"),condstrelse:new RegExp('{{\\s*([a-z][a-z0-9_]*)\\s*\\?\\s*"([^"]*)"\\s*:\\s*"([^"]*)"\\s*}}',"i"),cond:new RegExp('{{\\s*([a-z][a-z0-9_]*)\\s*\\?\\s*([^"]*)\\s*}}',"i"),text:new RegExp("{{","i")}}#t(e,t,r){t.index>0&&r.push({type:"txt",value:e.substring(0,t.index)})}parse(e){let t,r=[],a=new Set,s=["variable","condstrelse","condstr","cond","text"],n=0;for(;e.length>0;){let i=null;if(void 0!==t&&t===n)throw`Error parsing ${e}`;t=n;for(let t in s){if(0===e.length)break;if(i=this.#e[s[t]].exec(e),i)switch(n=i.index+i[0].length,s[t]){case"variable":this.#t(e,i,r),r.push({type:"var",name:i[1]}),a.add(i[1]),e=e.substr(n,e.length-n);break;case"condstr":case"cond":this.#t(e,i,r),r.push({type:s[t],var1:i[1],var2:i[2]}),a.add(i[1]),e=e.substr(n,e.length-n),"cond"===s[t]&&a.add(i[2]);break;case"condstrelse":this.#t(e,i,r),r.push({type:"condstrelse",var1:i[1],var2:i[2],var3:i[3]}),a.add(i[1]),e=e.substr(n,e.length-n);break;case"text":this.#t(e,i,r),e=e.substr(i.index,e.length-i.index)}if(i)break}if(null===i&&e.length>0){r.push({type:"txt",value:e});break}}return{variables:a,structure:r}}}class a{#r;#a;constructor(){this.#r=new r,this.#a=["tv-foreach","tv-true","tv-not-true","(tv-value)-([a-z0-9_-]+)","(tv-).*"].map((e=>new RegExp(e,"i")))}#s(e,t,r){e.has(t)||e.set(t,[]),e.get(t).push(r)}#n(e,t){t.forEach(((t,r)=>{e.has(r)?e.get(r).concat(t):e.set(r,t)}))}#i(e,t,r){let a=!1;const s=new Map;for(const n of e.attributes)for(const i of this.#a){const o=i.exec(n.name);if(o){if("tv-value"===o[1]){const t=document.createAttribute(o[2]),a=this.#r.parse(n.value);e.setAttributeNode(t),a.variables.forEach((e=>{this.#s(s,e,{node:t,type:"attribute",name:o[2],structure:a.structure,path:r})}))}else"tv-true"===o[0]?this.#s(s,n.value,{node:e,type:"truth",name:n.value,display:e.style.display,path:r}):"tv-not-true"===o[0]?this.#s(s,n.value,{node:e,type:"not-truth",name:n.value,display:e.style.display,path:r}):"tv-foreach"===o[0]&&(a={template:e.childNodes,childElementCount:e.childElementCount,type:"foreach",parent:e,name:n.value,variables:s,path:r,id:null},this.#s(t,n.value,a));break}}return a||this.#n(t,s),s.forEach((e=>e.path)),a}#o(e,t,r){const a=this.#i(e,t,r);let s;a?(t=a.variables,s=Array.from(e.childNodes).map((e=>e.cloneNode(!0)))):s=e.childNodes;let n=1;s.forEach(((e,s)=>{let i=[];e.nodeType===Node.TEXT_NODE?(i=this.#r.parse(e.textContent),i.variables.forEach((a=>{this.#s(t,a,{node:e,type:"text",structure:i.structure,path:r,index:s})}))):e.nodeType===Node.ELEMENT_NODE&&(this.#o(e,t,a?"":`${r}${""===r?"":">"}${e.nodeName}:nth-child(${n})`),n++)})),a&&(a.template=s)}parse(e){const t=new Map;return this.#o(e,t,""),t}}function s(e,t){return e.reduce(((e,r)=>{switch(r.type){case"var":return e+t[r.name];case"txt":return e+r.value;case"cond":return e+(t[r.var1]?t[r.var1]:t[r.var2]);case"condstr":return e+(t[r.var1]?r.var2:"");case"condstrelse":return e+(t[r.var1]?r.var2:r.var3)}}),"")}class n{#h;constructor(e){this.#h=e}update(e,t){(t||this.#h.node).textContent=s(this.#h.structure,e)}}class i{#h;constructor(e){this.#h=e}update(e,t){(t||this.#h.node).value=s(this.#h.structure,e)}}class o{#h;#l;constructor(e,t){this.#h=e,this.#l=t}update(e,t){let r=t||this.#h.node;e[this.#h.name]&&!this.#l||!e[this.#h.name]&&this.#l?r.style.display=this.#h.display:r.style.display="none"}}class h{#h;#d;constructor(e,t){this.#h=e,this.#d=l.create(e.variables,t),this.#h.manipulators=this.#d}#c(e,t){const r=new Event("tv-update");r.detail={nodes:e.filter((e=>e.nodeType!=Node.TEXT_NODE||""!=e.nodeValue.trim())),data:t},this.#h.parent.dispatchEvent(r)}update(e){if(e=e[this.#h.name],this.#h.parent.innerHTML="",Array.isArray(e))for(let t of e){const e=[];this.#d.forEach((e=>e.update(t))),this.#h.template.forEach((t=>{const r=t.cloneNode(!0);e.push(r),this.#h.parent.appendChild(r)})),this.#c(e,t)}}set(e,t){const r=[];this.#d.forEach((e=>e.update(t))),this.#h.template.forEach(((t,a)=>{const s=t.cloneNode(!0);r.push(s),e*this.#h.template.length+a===this.#h.parent.childNodes.length?this.#h.parent.appendChild(s):this.#h.parent.replaceChild(s,this.#h.parent.childNodes[e*this.#h.template.length+a])})),this.#c(r,t)}}const l={create:function(e,t){let r,a=[];return e.forEach((e=>{e.forEach((e=>{switch(e.type){case"text":r=new n(e);break;case"attribute":r=new i(e);break;case"truth":r=new o(e,!1);break;case"not-truth":r=new o(e,!0);break;case"foreach":r=new h(e,t);break;default:throw`Unknown type ${e.type}`}r.variables=e,a.push(r)}))})),a}};class d{#p;#d;#u;#y;constructor(e,t){this.#p=e,this.#d=t,this.#u=new WeakMap,this.#y=new WeakMap}get(e,t){if("function"==typeof e[t]||"object"!=typeof e[t])return e[t];let r;for(const a of this.#p)if(r=a.parent.children[t],!this.#u.has(r)){const s=new Proxy(e[t],new c(a.variables,a.manipulators,a.parent.children[t]));this.#u.set(r,s),this.#y.set(s,e[t]);break}return this.#u.get(r)}set(e,t,r){return this.#y.has(r)&&(r=this.#y.get(r)),e[t]=r,"length"===t?(this.#p.forEach((e=>{for(let t=0;t<e.parent.children.length-r;t++)e.parent.removeChild(e.parent.lastChild)})),!0):(this.#d.forEach((r=>null!=r.set&&r.set(t,e[t]))),!0)}}class c{#v;#d;#b;constructor(e,t,r){this.#v=e,this.#d=t,this.#b=r}get(e,t){if("object"==typeof e[t]&&Array.isArray(e[t])&&"foreach"===this.#v.get(t)[0].type){const r=new d(this.#v.get(t),this.#d);return new Proxy(e[t],r)}return e[t],e[t]}set(e,t,r){return e[t]=r,this.run(e),!0}run(e){this.#d.forEach((t=>{let r;if(this.#b){const e=""===t.variables.path?this.#b:this.#b.querySelector(t.variables.path);r="text"==t.variables.type?e.childNodes[t.variables.index]:"attribute"==t.variables.type?e.getAttributeNode(t.variables.name):e}t.update(e,r)}))}}class p{#f;#v;#d;constructor(e,t){this.#f=new Proxy({},new c(e,t)),this.#v=e,this.#d=t}set data(e){let t=new c(this.#v,this.#d);this.#f=new Proxy(e,t),t.run(e)}get data(){return this.#f}}function u(e){const t="string"==typeof e?document.querySelector(e):e;if(t){const e=(new a).parse(t),r=l.create(e);return new p(e,r)}throw new Error("Could not find template node")}return t})()));